package top.ten7;

import okhttp3.OkHttpClient;
import okhttp3.Request;
import okhttp3.Response;

import java.io.IOException;
import java.util.concurrent.TimeUnit;

public class checkVul {
    private final OkHttpClient client;
    private final String url;

    public checkVul(String url){
        this.url = parsUrl(url);
        this.client =  new OkHttpClient().newBuilder().connectTimeout(5, TimeUnit.SECONDS).build();
    }

    public boolean check() throws IOException {
        Request request = new Request.Builder().url(url+"services%20/WorkflowServiceXml").build();
        Response response = client.newCall(request).execute();
        String responseBody = response.body().string();
        if ((response.code()!=404) && (responseBody.indexOf("Invalid SOAP request")!=-1)){
            return true;
        }else {
            return false;
        }
    }

    public String parsUrl(String url){
        final String original = url;
        if (!url.startsWith("http://") && !url.startsWith("https://")) {
            url = "http://" + original;
        }
        if (!url.endsWith("/")) {
            url += "/";
        }
        return url;
    }
}
